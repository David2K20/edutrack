# 🚀 Render Deployment Guide

## Quick Summary
Your Django project is now configured for Render deployment with:
- ✅ **Persistent SQLite Database** (survives deployments)
- ✅ **Automatic Admin User Creation** (from environment variables)
- ✅ **Secure Credential Management** (no hardcoded passwords)
- ✅ **Production-Ready Settings**

## 🏃‍♂️ Quick Start (Deploy Now)

### 1. Push to Git Repository
```bash
git add .
git commit -m "Configure for Render deployment with persistent admin"
git push origin main
```

### 2. Deploy on Render
1. Go to [render.com](https://render.com) and sign in
2. Click "New" → "Web Service"
3. Connect your Git repository
4. Render will automatically detect the `render.yaml` file and use these settings:
   - **Build Command**: `./build.sh`
   - **Start Command**: `gunicorn --bind 0.0.0.0:$PORT django_project.wsgi:application`
   - **Python Version**: 3.11.0

### 3. Access Your Admin Panel
After deployment completes:
1. Visit your Render URL: `https://your-service-name.onrender.com/admin/`
2. Login with:
   - **Username**: `admin`
   - **Email**: `admin@edutrack.com`
   - **Password**: Check Render Dashboard → Your Service → Environment → `DJANGO_ADMIN_PASSWORD`

## 🔧 Local Testing

### Test Locally Before Deployment
```bash
# Create local admin user for testing
python setup_local_admin.py

# Run local server
python manage.py runserver

# Visit http://127.0.0.1:8000/admin/
# Login: admin / admin123
```

### Test Custom Management Command
```bash
# Test with custom credentials
python manage.py ensure_admin_user --username myuser --email test@example.com --password mypass123

# Test with environment variables
set DJANGO_ADMIN_USERNAME=envuser
set DJANGO_ADMIN_EMAIL=env@example.com
set DJANGO_ADMIN_PASSWORD=envpass123
python manage.py ensure_admin_user
```

## 🔐 Admin Credentials Management

### How It Works
1. **Environment Variables**: Admin credentials are set in `render.yaml`
2. **Auto-Creation**: The `build.sh` script runs `ensure_admin_user` on every deployment
3. **Secure Storage**: Passwords are auto-generated by Render (not visible in code)

### Environment Variables in Render
These are automatically configured in your `render.yaml`:
- `DJANGO_ADMIN_USERNAME` = `admin`
- `DJANGO_ADMIN_EMAIL` = `admin@edutrack.com`
- `DJANGO_ADMIN_PASSWORD` = Auto-generated secure password

### Finding Your Production Password
1. Go to Render Dashboard
2. Select your web service
3. Go to "Environment" tab
4. Find `DJANGO_ADMIN_PASSWORD` value

### Changing Admin Credentials
1. In Render Dashboard → Environment, update:
   - `DJANGO_ADMIN_USERNAME` (if needed)
   - `DJANGO_ADMIN_EMAIL` (if needed)
   - `DJANGO_ADMIN_PASSWORD` (set new password)
2. Redeploy your service or run manual command

## 💾 Database Persistence

### How SQLite Persists on Render
- **Persistent Disk**: 1GB disk mounted at `/var/data/`
- **Database Location**: `/var/data/db.sqlite3`
- **Survival**: Database survives app restarts and redeployments

### Database Commands
```bash
# In Render Shell:
python manage.py shell

# Check database location
python -c "from django.conf import settings; print(settings.DATABASES['default']['NAME'])"

# List all users
python manage.py shell -c "from django.contrib.auth.models import User; [print(f'{u.username} - {u.email} - Staff: {u.is_staff}') for u in User.objects.all()]"
```

## 🛠️ Troubleshooting

### Can't Login to Admin
1. **Check Admin User Exists**:
   ```bash
   # In Render Shell
   python manage.py shell -c "from django.contrib.auth.models import User; print('Admin exists:', User.objects.filter(username='admin').exists())"
   ```

2. **Recreate Admin User**:
   ```bash
   # In Render Shell
   python manage.py ensure_admin_user
   ```

3. **Reset Password**:
   ```bash
   # In Render Shell
   python manage.py changepassword admin
   ```

### Database Issues
1. **Check Database Path**:
   ```bash
   # In Render Shell
   python -c "from django.conf import settings; print('DB Path:', settings.DATABASES['default']['NAME'])"
   ```

2. **Run Migrations**:
   ```bash
   # In Render Shell
   python manage.py migrate
   ```

3. **Check Database Contents**:
   ```bash
   # In Render Shell
   python manage.py dbshell
   .tables
   .quit
   ```

### Build Issues
- Check build logs in Render Dashboard
- Ensure `build.sh` has execute permissions
- Verify all dependencies in `requirements.txt`

## 📁 Important Files

| File | Purpose |
|------|---------|
| `render.yaml` | Render service configuration |
| `build.sh` | Build script (runs migrations + admin setup) |
| `settings.py` | Django settings with persistent DB path |
| `students/management/commands/ensure_admin_user.py` | Custom admin creation command |
| `setup_local_admin.py` | Local testing helper |

## 🔄 Updating Your Deployment

### Code Changes
```bash
git add .
git commit -m "Your changes"
git push origin main
# Render auto-deploys
```

### Admin Password Change
1. Update `DJANGO_ADMIN_PASSWORD` in Render Environment
2. In Render Shell: `python manage.py ensure_admin_user`

### Database Migration
```bash
# After model changes locally:
python manage.py makemigrations
git add .
git commit -m "Add migrations"
git push origin main
# Render runs migrations automatically via build.sh
```

## ✅ Verification Checklist

After deployment, verify:
- [ ] App loads at your Render URL
- [ ] Admin panel accessible at `/admin/`
- [ ] Can login with admin credentials
- [ ] Database persists after redeployment
- [ ] Static files load correctly

## 📞 Support

If you encounter issues:
1. Check Render build/deploy logs
2. Use Render Shell for debugging
3. Check this guide's troubleshooting section

---

**🎉 Your Django app is now production-ready on Render with persistent admin access!**
